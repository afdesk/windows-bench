---
version: 2.0.0
id: 1
description: Account Policies
type: domain-controller
groups:
  - id: 1.1
    description: Password Policy
    checks:
      - id: 1.1.1
        description: Ensure 'Enforce password history' is set to '24 or more
          password(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty PasswordHistoryCount
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty PasswordHistoryCount
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 24
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 24 or more password(s):
            Computer Configuration\Policies\Windows Settings\Security Settings\Account
            Policies\Password Policy\Enforce password history
        scored: true
      - id: 1.1.2
        description: Ensure 'Maximum password age' is set to '365 or fewer days, but not
          0' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MaxPasswordAge | Select -ExpandProperty
              TotalDays
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MaxPasswordAge | Select -ExpandProperty TotalDays
        tests:
          bin_op: and
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 365
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 365 or fewer days, but not 0:
           Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Maximum password age
        scored: true
      - id: 1.1.3
        description: Ensure 'Minimum password age' is set to '1 or more day(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MinPasswordAge | Select -ExpandProperty
              TotalDays
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MinPasswordAge | Select -ExpandProperty TotalDays
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 1
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 1 or more day(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password age
        scored: true
      - id: 1.1.4
        description: Ensure 'Minimum password length' is set to '14 or more
          character(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MinPasswordLength
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MinPasswordLength
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 14
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 14 or more character(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password length
        scored: true
      - id: 1.1.5
        description: Ensure 'Password must meet complexity requirements' is set to
          'Enabled' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty ComplexityEnabled
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty ComplexityEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "True"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 14 or more character(s):
               Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Password must meet complexity requirements
        scored: true
      - id: 1.1.6
        description: Ensure 'Relax minimum password length limits' is set to 'Enabled'
          (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\SAM\RelaxMinimumPasswordLengthLimits
            Server: Get-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\SAM\RelaxMinimumPasswordLengthLimits
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "True"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to Enabled:
               Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Relax minimum password length limits
        scored: true
      - id: 1.1.7
        description: Ensure 'Store passwords using reversible encryption' is set to
          'Disabled'
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty ReversibleEncryptionEnabled
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty ReversibleEncryptionEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "False"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to Disabled:
                Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Store passwords using reversible encryption
        scored: true
  - id: 1.2
    description: Account Lockout Policy
    checks:
      - id: 1.2.1
        description: Ensure 'Account lockout duration' is set to '15 or more minute(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutDuration | Select -ExpandProperty Minutes
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutDuration | Select -ExpandProperty Minutes
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Account lockout duration
        scored: true
      - id: 1.2.2
        description: Ensure 'Account lockout threshold' is set to '5 or fewer invalid logon attempt(s), but not 0' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutThreshold
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutThreshold
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 5
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 5 or fewer invalid login attempt(s), but not 0:
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Account lockout threshold
        scored: true
      - id: 1.2.3
        description: Ensure 'Allow Administrator account lockout' is set to 'Enabled' (Manual)
        type: manual
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policies\Allow Administrator account lockout
        scored: true

      - id: 1.2.4
        description: Ensure 'Reset account lockout counter after' is set to '15 or more minute(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty LockoutObservationWindow | Select -ExpandProperty Minutes
            Server: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty LockoutObservationWindow | Select -ExpandProperty Minutes
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Reset account lockout counter after
        scored: true
  - id: 2.2
    description: User Rights Assignment
    checks:
      - id: 2.2.1
        description: Ensure 'Access Credential Manager as a trusted caller' is set to 'No One' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTrustedCredManAccessPrivilege" ; Remove-Item seccfg
            Server: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTrustedCredManAccessPrivilege" ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true

        remediation: >
          To establish the recommended configuration via GP, set the following UI path to "No One":
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access Credential Manager as a trusted caller
        scored: true
      - id: 2.2.2
        description: Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users, ENTERPRISE DOMAIN CONTROLLERS' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeNetworkLogonRight") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544,S-1-5-11,S-1-5-9"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network
        scored: true
      - id: 2.2.3
        description: Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            Server: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeNetworkLogonRight") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544,S-1-5-11"
              set: true

        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network
        scored: true
      - id: 2.2.4
        description: Ensure 'Act as part of the operating system' is set to 'No One' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTcbPrivilege" ; Remove-Item seccfg
            Server: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTcbPrivilege" ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to "No One":
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Act as part of the operating system
        scored: true
      - id: 2.2.5
        description: Ensure 'Add workstations to domain' is set to 'Administrators' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeMachineAccountPrivilege") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to Administrators:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Add workstations to domain
        scored: true
  - id: 2.3
    description: Security Options
    checks:
      - id: 2.3.1.1
        description: Ensure 'Block Microsoft accounts' is set to 'Users can't add or log on with Microsoft accounts' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' noconnecteduser
            Server: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' noconnecteduser
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true

        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Users can't add or log on with Microsoft accounts':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Block Microsoft accounts
        scored: true

  - id: 5
    description: System Services
    checks:
      - id: 5.1
        description: Ensure 'Print Spooler (Spooler)' is set to 'Disabled' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Spooler' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Print Spooler
        scored: true
      - id: 5.2
        description: Ensure 'Print Spooler (Spooler)' is set to 'Disabled' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            Server: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Spooler' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Print Spooler
        scored: true
